---
layout: base.pug
stylesheet: /style/political-parties.css
eleventyComputed:
    description: "Want to know whether political parties in #{watchId} actually support their statements? Now you can. Complete with articles."
---
mixin tagbutton(type, id, title=false)
    - if (!title) { title = id };
    button(name=type, value=id).tag=title

-
    const relevantParties = AFAWatchpigeonParties.filter(party => party.areas.includes(watchId));
    const relevantPartyIds = relevantParties.map((party) => party.id)
    const relevantArticles = AFAWatchpigeonArticles.filter(article => article.responses.find((response) => relevantPartyIds.includes(response.party.id)));
    let points = {};
    let maxScale = {};
    const relatedArticles = [];
    // Filter out parties with no configuration
    //filterParties((party)=> {return party == null});

    function addToObjectInt(object, key, increaseWith) {
        if (!Object.hasOwn(object, key)) {
            object[key] = 0;
        }
        object[key] += increaseWith;
        return object;
    }

    relevantArticles.forEach((article, articleId) => {
        article.responses.forEach((response) => {
            const partyId = response.party.id;
            points = addToObjectInt(points, partyId, response.score)
            maxScale = addToObjectInt(maxScale, partyId, 3)
        });
    });

main
    h1
        nav(aria-label="breadcrumb")
            ul
                li
                    a(href="/watchpigeon/") Watchpigeon
                li
                    a(href="#")=watchId
    section#scale
        h2 Scale
        each party in relevantParties
            section.party

                img(src="/assets/" + party.logo.filename_download)
            input.no-bar(type="range" id=party.id min=-maxScale[party.id] max=maxScale[party.id] value=points[party.id])
                
            //p
        
                //each party in relevantParties
                    - 
                        let px;
                        let value;
                        if (party.points >= 0) {
                            //console.log(party.points)
                            //console.log(maxScale[party.id])
                            //console.log(party.name)
                            value = party.points / maxScale[party.id] * 100  //50 - (100/maxScale - party.points)

                            from = classname == "desktop" ? "right" : "bottom";
                        } else {
                            let points = party.points * -1;
                            value = points / maxScale[party.id] * 100;  //50 - (100/maxScale - party.points)
                            from = classname == "desktop" ? "left" : "top";
                            //left = party.points / maxScale * 100  //50 - (100/maxScale - party.points)
                            //left = 50 + (100/maxScale - points)

                        }
                        
                    if party.name
                        //svg.party(style="left: " + left + "%")
                        img.party(title=party.name style=from + ": " + value + "%" src=`/assets/watchpigeon/${party.id}.svg` alt=`${party.name} logo`)

    section
        h2 Scoring system
        p Dependant on whether the party is in line with our values, the score will be added or subtracted.
        ul
            li +/- 1
                ol
                    li (+) Supported with leeway
                    li (-) Opposes with leeway
            li +/- 2
                ol
                    li (+) Peddled by members and/or website
                    li (-) Horrible stuff peddled by members and/or website
            li +/-3
                ol
                    li (+) Active campaign point, support proven through external sources, pushes rights forwards
                    li (-) Negative active campaign point, opposition proven through external sources, pushes rights backwards
        h2 Considered articles

        fieldset#tags
            legend Tags

            
            each subject in AFAWatchpigeonSubjects
                +tagbutton("subject", subject.id, subject.name)
            
            hr

            each party in relevantParties
                +tagbutton("party", party.id, party.name)

            hr


        section#articles
            each article in relevantArticles
                -
                    const involvedPartyIds = article.responses.map(response => response.party.id)
                    const involvedParties = relevantParties.filter((party) => involvedPartyIds.includes(party.id));
                    const involvedSubjects = article.subjects.map(subject => subject.AFAWatchpigeonSubjects_id)
                    const allTags =involvedParties.map(party => party.id).concat(involvedSubjects.map(subject => subject.id)).join(",");
                article(data-tags=allTags)
                    header
                        h3 #{article.title} #{article.year}
                    if article.note
                        p Note: #{article.note}

                    h4 Party scores
                    ul
                        each party in involvedParties
                            - const response = article.responses.find(response => response.party.id == party.id);
                            +tagbutton("party", party.id, `${party.name}: ${response.score}, ${response.note}`)

                    h4 Tags
                    ul
                        each subject in involvedSubjects
                            +tagbutton("subject", subject.id, subject.name)
                    
                    - if (!Array.isArray(article.url))
                        a(href=article.url)=article.url
                    - else
                        ul
                            each url in article.url
                                li
                                    a(href=url)=url

    script(src="/scripts/political-parties.js")